<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Connection Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">Supabase Connection Test</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Test Connection</h2>
            <button onclick="testConnection()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Test Supabase Connection
            </button>
            <div id="connection-result" class="mt-4"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Test Save Data</h2>
            <button onclick="testSave()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                Save Test Data
            </button>
            <div id="save-result" class="mt-4"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Test Load Data</h2>
            <button onclick="testLoad()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                Load Test Data
            </button>
            <div id="load-result" class="mt-4"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Setup Instructions</h2>
            <ol class="list-decimal list-inside space-y-2 text-gray-700">
                <li>Make sure you've run the SQL script in your Supabase project</li>
                <li>The SQL script is in <code class="bg-gray-200 px-1 rounded">supabase_setup.sql</code></li>
                <li>Go to Supabase Dashboard → SQL Editor → New Query</li>
                <li>Paste the SQL script and click "Run"</li>
                <li>Then test the connection above</li>
            </ol>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        const supabaseUrl = 'https://lgovvztkuqnpsshdrwyu.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxnb3Z2enRrdXFucHNzaGRyd3l1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwMTY0OTgsImV4cCI6MjA4NTU5MjQ5OH0.0gks6pz9g8JCP6LMiKEGQj3J-M27ljGPLwv-umyoPVA';
        const supabase = createClient(supabaseUrl, supabaseKey);

        window.testConnection = async () => {
            const result = document.getElementById('connection-result');
            result.innerHTML = '<p class="text-blue-500">Testing connection...</p>';
            
            try {
                const { data, error } = await supabase
                    .from('app_data')
                    .select('id')
                    .limit(1);
                
                if (error) {
                    result.innerHTML = `<p class="text-red-500">❌ Connection failed: ${error.message}</p>`;
                    if (error.code === '42P01') {
                        result.innerHTML += `<p class="text-yellow-600 mt-2">⚠️ Table not found. Please run the SQL setup script first.</p>`;
                    }
                } else {
                    result.innerHTML = `<p class="text-green-500">✅ Connection successful!</p>`;
                }
            } catch (e) {
                result.innerHTML = `<p class="text-red-500">❌ Error: ${e.message}</p>`;
            }
        };

        window.testSave = async () => {
            const result = document.getElementById('save-result');
            result.innerHTML = '<p class="text-blue-500">Saving test data...</p>';
            
            const testData = {
                test: true,
                timestamp: new Date().toISOString(),
                message: "Test data from LearnNovaLMS"
            };
            
            try {
                const { data, error } = await supabase
                    .from('app_data')
                    .upsert({ 
                        id: 'test_record', 
                        data: testData,
                        updated_at: new Date().toISOString()
                    }, { 
                        onConflict: 'id' 
                    });
                
                if (error) {
                    result.innerHTML = `<p class="text-red-500">❌ Save failed: ${error.message}</p>`;
                } else {
                    result.innerHTML = `<p class="text-green-500">✅ Data saved successfully!</p>`;
                }
            } catch (e) {
                result.innerHTML = `<p class="text-red-500">❌ Error: ${e.message}</p>`;
            }
        };

        window.testLoad = async () => {
            const result = document.getElementById('load-result');
            result.innerHTML = '<p class="text-blue-500">Loading test data...</p>';
            
            try {
                const { data, error } = await supabase
                    .from('app_data')
                    .select('data')
                    .eq('id', 'test_record')
                    .single();
                
                if (error) {
                    result.innerHTML = `<p class="text-red-500">❌ Load failed: ${error.message}</p>`;
                } else {
                    result.innerHTML = `<p class="text-green-500">✅ Data loaded successfully!</p>`;
                    result.innerHTML += `<pre class="bg-gray-100 p-4 rounded mt-2 text-sm overflow-auto">${JSON.stringify(data, null, 2)}</pre>`;
                }
            } catch (e) {
                result.innerHTML = `<p class="text-red-500">❌ Error: ${e.message}</p>`;
            }
        };
    </script>
</body>
</html>